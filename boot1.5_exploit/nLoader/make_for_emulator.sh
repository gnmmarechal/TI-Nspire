#!/bin/bash -e
# fixme: too duplicate
a=norun
[ "$1" = "run" ] && a=
rm -rf libgcc
unzip -qq libgcc.zip
for i in CAS_OS CAS_OS_no_patches NONCAS_OS; do
echo $i
echo "#define $i" > casos.h
[ "$i" = "CAS_OS_no_patches" ] && echo "#define CAS_OS" >> casos.h
cd ndless_loader
make clean
make
make cleanrem
cd ..
cd show_cas_image
make clean
make
make -f MakefileCR4 clean
make -f MakefileCR4
make cleanrem
cd ..
make -f _Makefile clean
make -f _Makefile
rm -f casos.h show_cas_image*.bin ndless_loader.bin
../mkexp.sh loader.bin $a
mv test.img nLoader_$i.img.tns
done
rm -rf libgcc loader.bin
