GCC = arm-none-eabi-gcc
LD = arm-none-eabi-ld
# important! -Os
GCCFLAGS = -Os -Wall -Werror -Wextra -marm -mcpu=arm926ej-s -nostdlib -nostartfiles -s -ffreestanding -std=c11 -fomit-frame-pointer -DBUILDFORCR4
LDFLAGS = -nostdlib -nostartfiles -e show_cas_image_cr4 -T ldscript
OBJCOPY := "$(shell which arm-elf-objcopy 2>/dev/null)"
ifeq (${OBJCOPY},"")
	OBJCOPY := arm-none-eabi-objcopy
endif
BIN = ../show_cas_image_cr4.bin

all: $(BIN)

show_cas_image_cr4.o: show_cas_image.c
	$(GCC) $(GCCFLAGS) -o $@ -c $<

$(BIN): show_cas_image_cr4.o
	$(LD) $(LDFLAGS) $^ -o $(<:.o=.elf)
	$(OBJCOPY) -O binary $(<:.o=.elf) $@
clean:
	rm -f *.o *.elf
	rm -f $(BIN)