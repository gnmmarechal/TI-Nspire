#include "../types.h"
#include "../screen.h"
#include "../patcherloc.h"

#define casimage ((volatile unsigned short *) DATACASIMAGE_LOC)

// There are, for reasons I do not understand (stack?), 
// EXTREME constraints on the number of variables/ifs/etc 
// I can use here without crashing
// TL;DR DO NOT TOUCH THIS OR IT WILL STOP WORKING

#define  insane_unroll1(i)  insane_unroll2(i,0); insane_unroll2(i,1); insane_unroll2(i,2); insane_unroll2(i,3); insane_unroll2(i,4); insane_unroll2(i,5); insane_unroll2(i,6); insane_unroll2(i,7); insane_unroll2(i,8); insane_unroll2(i,9); insane_unroll2(i,10); insane_unroll2(i,11)
#ifdef BUILDFORCR4
#define  insane_unroll2(j,i) if(casimage[i*29+j]) scr_base[(145+j)*SCREEN_HEIGHT+170+i]=casimage[i*29+j]
#else
#define  insane_unroll2(j,i) if(casimage[i*29+j]) scr_base[(170+i)*SCREEN_WIDTH+145+j]=casimage[i*29+j]
#endif

void __attribute__((naked)) show_cas_image(void) {
        volatile unsigned short *scr_base = (*(void**)0xC0000010);
		for(int j = 0; j < 29; j++) {
			 insane_unroll1(j);
		}
    __asm volatile(
                   "LDR    PC, =0x1187e9bc \n"
                   ); // after it prints Loading Operating System
    __builtin_unreachable();
}
