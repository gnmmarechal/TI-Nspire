#include "types.h"

void* memcpy(void* dest, void* src, uint32_t size) {
	uint8_t* cdest=(uint8_t*)dest;
	uint8_t* csrc=(uint8_t*)src;
	uint32_t i;
	for(i=0;i<size;i++)
		cdest[i]=csrc[i];
	return dest;
}

void ut_disable_watchdog(void) {
	// Disable the watchdog on CX that may trigger a reset
	*(volatile unsigned*)0x90060C00 = 0x1ACCE551; // enable write access to all other watchdog registers
	*(volatile unsigned*)0x90060008 = 0; // disable reset, counter and interrupt
	*(volatile unsigned*)0x90060C00 = 0; // disable write access to all other watchdog registers
}

/* For internal use only.
 * Synchronous and doesn't require the IRQ to be enabled (actually the IRQ *must* be disabled).
 * But interfers with the OS IRQ handlers when renabled: the OS RS232 out buffer will be entirely
 * retransmitted. */


void putsn( char *str) {
	volatile unsigned *line_status_reg = (unsigned*)0x90020018;
	volatile unsigned *xmit_holding_reg = (unsigned*)0x90020000;
	while(*str) {
		while(!(*line_status_reg & 0b10000000)); // wait for empty xmit holding reg
		*xmit_holding_reg = *str++;
	}
	while(!(*line_status_reg & 0b10000000)); // wait for empty xmit holding reg
}

void puts( char *str) {
	putsn(str);
	putsn("\r\n");
}

void abort() {
	puts("ABORT");
	while(1);
}


unsigned char asicflags() {
	return ((*(volatile unsigned int*) 0x900A002C)>>26)&0b11111;
}
